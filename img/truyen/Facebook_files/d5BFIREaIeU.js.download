;/*FB_PKG_DELIM*/

__d("LSHandleFTSIndexProtobufMessageResponse",["LSArrayGetObjectAt","LSDecryptMessageProtobufs","LSIsEncryptionVersionSecure","LSLogMebClientEvent.nop","LSRestoreProtobufs.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][handleFTSIndexProtobufMessageResponse] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.storedProcedure(b("LSDecryptMessageProtobufs"),a[0],a[2]).then(function(a){return a=a,d[2]=a[0],d[3]=a[1],a})},function(b){return d[4]=a[3].get("restore_task_source"),d[5]=a[3].get("request_id"),c.i64.neq(a[4],void 0)?c.sequence([function(b){return c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}).next().then(function(b,e){var f=b.done;b=b.value;return f?d[13]=!1:(e=b.item,d[16]=e.deviceId,c.i64.neq(d[16],void 0)?d[15]=c.i64.neq(d[16],a[4]):d[15]=!1,d[13]=d[15])})},function(a){return d[6]=d[13]}]):c.resolve(d[6]=!1)},function(e){return d[6]?c.resolve(0):c.sequence([function(e){return d[2]!==void 0?c.sequence([function(e){return d[14]=a[1].get("has_more_before"),d[15]=a[1].get("has_more_after"),d[14]?(d[23]=a[1].get("next_message_timestamp_ms_before"),d[16]=d[23]):d[16]=void 0,d[15]?(d[23]=a[1].get("next_message_timestamp_ms_after"),d[17]=d[23]):d[17]=void 0,d[18]=a[1].get("has_more_before"),d[19]=a[1].get("has_more_after"),d[20]=a[3].get("request_id"),d[21]=a[3].get("reference_timestamp"),d[22]=c.createArray(),c.nativeOperation(b("LSRestoreProtobufs.nop"),a[2],d[2],d[18],d[16],d[19],d[17],!1,d[20],d[21],a[5],d[22],d[4],void 0)},function(a){return d[13]=void 0}]):c.resolve((d[3]!==void 0?(d[14]=d[3].get("error_code"),c.i64.eq(d[14],c.i64.cast([0,1]))?0:0):0,d[13]=d[3]))},function(e){return d[13]!==void 0?c.sequence([function(e){return d[14]=a[3].get("request_id"),c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,e){var f=a.done;a=a.value;return f?d[15]=void 0:(e=a.item,c.sequence([function(a){return d[25]=e.deviceId,d[24]=e.backupTenancy,d[23]=e.encryptionVersion,d[18]=void 0,c.i64.neq(d[18],void 0)?c.resolve(d[19]=d[18]):c.sequence([function(a){return d[26]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[27]=a[0],a})},function(a){return d[27]?d[36]=(d[26].push(c.i64.cast([0,0])),d[26]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[28]=a[0],a})},function(a){return d[28]?d[36]=(d[26].push(c.i64.cast([0,2])),d[26]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[29]=a[0],a})},function(a){return d[29]?d[36]=(d[26].push(c.i64.cast([0,3])),d[26]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[30]=a[0],a})},function(a){return d[30]?d[36]=(d[26].push(c.i64.cast([0,4])),d[26]):0,d[31]=c.createArray(),d[32]=c.i64.of_int32(d[26].length),c.i64.gt(d[32],c.i64.cast([0,0]))?c.loopAsync(d[32],function(a){return d[36]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[26],d[36]).then(function(a){return a=a,d[37]=a[0],d[38]=a[1],a})},function(a){return d[39]=(d[31].push(d[37]),d[31])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[36]=c.createArray(),d[37]=c.i64.of_int32(d[31].length),c.i64.gt(d[37],c.i64.cast([0,0]))?c.loopAsync(d[37],function(a){return d[39]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[31],d[39]).then(function(a){return a=a,d[40]=a[0],d[41]=a[1],a})},function(a){return d[42]=(d[36].push(c.i64.to_string(d[40])),d[36])}])}):c.resolve()},function(a){return d[38]=d[36].join(","),d[33]=d[38]}])},function(a){return d[31].some(function(a){return c.i64.eq(d[23],a)})?d[34]=d[23]:d[34]=void 0,c.i64.neq(d[34],void 0)?d[35]=d[34]:d[35]=void 0,d[19]=d[35]}])},function(a){return c.i64.neq(d[19],void 0)?d[20]=d[19]:d[20]=c.i64.cast([0,0]),c.i64.neq(d[24],void 0)?d[21]=d[24]:d[21]=c.i64.cast([0,1]),c.i64.neq(d[25],void 0)?d[22]=d[25]:d[22]=void 0,d[15]=d[22]}]))})},function(b){return d[17]=a[3].get("restore_task_source")}]):c.resolve()}])},function(a){return d[7]=c.i64.of_float(Date.now()),d[8]=c.i64.random(),d[10]="Finishing execution. Execution time: ",d[11]=c.i64.to_string(c.i64.sub(d[7],d[0])),d[12]=" ms",d[9]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][handleFTSIndexProtobufMessageResponse] ",d[9],d[10],d[9],d[11],d[9],d[12]].join("")),c.i64.eq(c.i64.mod_(d[8],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[13]=",",d[14]=c.createArray(),void 0!==void 0?d[15]=(d[14].push(void 0),d[14]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"handleFTSIndexProtobufMessageResponse",[d[10],d[13],d[11],d[13],d[12]].join(""),d[14],c.i64.cast([0,4]))):c.resolve()}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsHandleFTSIndexProtobufMessageResponseStoredProcedure";a.__tables__=["secure_encrypted_backups_client_state"];e.exports=a}),null);