;/*FB_PKG_DELIM*/

__d("LSSyncBumpThreadDataToClient",["LSIssueNewTask","gkx"],(function(a,b,c,d,e,f,g){function a(){var a=arguments,d=a[a.length-1],e=[],f=[];return d.sequence([function(f){return d.filter(d.db.table(9).fetch([[[a[0]]]]),function(b){return d.i64.eq(b.threadKey,a[0])&&d.i64.ge(a[1],b.lastActivityTimestampMs)}).next().then(function(f,g){var h=f.done;f=f.value;return h?0:(g=f.item,d.sequence([function(f){return d.i64.eq(g.parentThreadKey,d.i64.cast([-1,4294967286]))&&d.i64.eq(a[2],d.i64.cast([0,2]))&&c("gkx")("9583")?(e[0]=new d.Map(),e[0].set("thread_fbid",a[0]),e[0].set("force_upsert",!1),e[0].set("use_open_messenger_transport",!1),e[0].set("sync_group",d.i64.cast([0,95])),e[0].set("metadata_only",!1),e[0].set("preview_only",!1),e[1]=e[0].get("thread_fbid"),e[2]=d.toJSON(e[0]),d.storedProcedure(b("LSIssueNewTask"),d.i64.to_string(e[1]),d.i64.cast([0,209]),e[2],void 0,void 0,d.i64.cast([0,0]),d.i64.cast([0,0]),void 0,void 0,d.i64.cast([0,0]),d.i64.cast([0,0]))):d.resolve()},function(b){return d.forEach(d.db.table(9).fetch([[[a[0]]]]),function(b){var c=b.update;b.item;return c({lastActivityTimestampMs:a[1]})})},function(b){return d.i64.eq(a[2],d.i64.cast([0,1]))?d.forEach(d.db.table(9).fetch([[[a[0]]]]),function(b){var c=b.update;b.item;return c({lastReadWatermarkTimestampMs:a[1]})}):d.i64.eq(a[2],d.i64.cast([0,2]))?d.resolve(0):d.i64.eq(a[2],d.i64.cast([0,3]))?d.i64.ge(g.lastReadWatermarkTimestampMs,g.lastActivityTimestampMs)?d.forEach(d.db.table(9).fetch([[[a[0]]]]),function(b){var c=b.update;b.item;return c({lastReadWatermarkTimestampMs:a[1]})}):d.resolve():d.resolve(0)}]))})},function(a){return d.resolve(f)}])}a.__sproc_name__="LSE2EEMessagingMetadataMailboxSyncBumpThreadDataToClientStoredProcedure";a.__tables__=["threads"];d=a;g["default"]=d}),98);